{{ 'section-featured-products.css' | asset_url | stylesheet_tag }}

{%- assign collection = collections[section.settings.collection] -%}
{%- assign products = collection.products -%}

{%- style -%}
  #shopify-section-{{ section.id }} {
    --section-spacing-top: {{ section.settings.spacing_top }}rem;
    --section-spacing-bottom: {{ section.settings.spacing_bottom }}rem;
  }
{%- endstyle -%}

<div class="featured-products section-{{ section.id }}">
  <div class="container {{ section.settings.section_width }}">
    <div class="section-header">
      {% if section.settings.heading != blank %}
        <h2 class="section-heading {{ section.settings.heading_size }}">
          {{ section.settings.heading }}
        </h2>
      {% endif %}

      {% if section.settings.description != blank %}
        <p class="section-description">
          {{ section.settings.description }}
        </p>
      {% endif %}
    </div>

    {% if products.size > 0 %}
      <div class="products-grid">
        {%- for product in products limit: section.settings.max_products -%}
          <div class="product-card">
            {% if product.featured_image %}
              <a href="{{ product.url }}" class="product-card__image-link">
                {{
                  product.featured_image
                  | image_url: width: 400
                  | image_tag:
                    widths: '200, 300, 400',
                    sizes: '(max-width: 749px) 50vw, 25vw',
                    class: 'product-card__image',
                    loading: 'lazy'
                }}
              </a>
            {% endif %}

            <div class="product-card__content">
              <h3 class="product-card__title">
                <a href="{{ product.url }}">
                  {{ product.title }}
                </a>
              </h3>

              <div class="product-card__price">
                {% if product.compare_at_price > product.price %}
                  <span class="product-card__price--sale">
                    {{ product.price | money }}
                  </span>
                  <span class="product-card__price--compare">
                    {{ product.compare_at_price | money }}
                  </span>
                {% else %}
                  <span class="product-card__price--regular">
                    {{ product.price | money }}
                  </span>
                {% endif %}
              </div>

              {% if product.available %}
                <form method="post" action="{{ routes.cart_add_url }}" class="product-card__form">
                  <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                  <button type="submit" class="product-card__button button button--primary" name="add">
                    {{ 'products.product.add_to_cart' | t }}
                  </button>
                </form>
              {% else %}
                <button class="product-card__button button button--disabled" disabled>
                  {{ 'products.product.sold_out' | t }}
                </button>
              {% endif %}
            </div>
          </div>
        {%- endfor -%}
      </div>

      {% if section.settings.show_view_all and section.settings.view_all_text != blank %}
        <div class="section-footer">
          <a href="{{ collection.url }}" class="view-all-link button button--outlined">
            {{ section.settings.view_all_text }}
          </a>
        </div>
      {% endif %}
    {% else %}
      <div class="no-products">
        <p>{{ 'sections.featured_products.no_products' | t }}</p>
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Featured Products",
  "class": "section-featured-products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Best Sellers"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Discover our most popular products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Maximum products to show",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View all' button",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View all button text",
      "default": "View All Products"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        {
          "value": "h1",
          "label": "H1"
        },
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        }
      ],
      "default": "h2"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "spacing_top",
      "label": "Spacing top",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "rem",
      "default": 2
    },
    {
      "type": "range",
      "id": "spacing_bottom",
      "label": "Spacing bottom",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "rem",
      "default": 4
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section width",
      "options": [
        {
          "value": "max-w-page",
          "label": "Page"
        },
        {
          "value": "max-w-fluid",
          "label": "Fluid"
        },
        {
          "value": "max-w-full",
          "label": "Full"
        }
      ],
      "default": "max-w-page"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Featured Products",
      "category": "Products"
    }
  ]
}
{% endschema %}