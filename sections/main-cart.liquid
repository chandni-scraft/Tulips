{{ 'section-main-cart.css' | asset_url | stylesheet_tag }}

{%- style -%}
  #shopify-section-{{ section.id }} {
    --section-spacing-top: {{ section.settings.spacing_top }}rem;
    --section-spacing-bottom: {{ section.settings.spacing_bottom }}rem;
  }
{%- endstyle -%}

<div class="main-cart section-{{ section.id }} color-{{ section.settings.color_scheme }} gradient">
  <div class="container {{ section.settings.section_width }}">
    <h1 class="cart-title">{{ 'cart.title' | t }}</h1>

    {%- if cart.item_count > 0 -%}
      <form action="{{ routes.cart_url }}" class="cart__contents" method="post" id="cart">
        <div class="cart__items">
          <table class="cart-items">
            <thead class="cart-items__header">
              <tr>
                <th class="cart-items__header-item" colspan="2">Product</th>
                <th class="cart-items__header-item">Price</th>
                <th class="cart-items__header-item">Quantity</th>
                <th class="cart-items__header-item">Total</th>
              </tr>
            </thead>
            <tbody>
              {%- for item in cart.items -%}
                <tr class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
                  <td class="cart-item__image">
                    <a href="{{ item.url }}" class="cart-item__link" tabindex="-1" aria-hidden="true">
                      {% if item.image %}
                        {{
                          item.image
                          | image_url: width: 150
                          | image_tag:
                            widths: '75, 100, 150',
                            sizes: '75px',
                            class: 'cart-item__img',
                            loading: 'lazy'
                        }}
                      {% else %}
                        {{ 'product-1' | placeholder_svg_tag: 'cart-item__img placeholder' }}
                      {% endif %}
                    </a>
                  </td>
                  <td class="cart-item__details">
                    <div class="cart-item__title">
                      <a href="{{ item.url }}" class="cart-item__title-link">
                        {{ item.product.title | escape }}
                      </a>
                    </div>
                    {%- unless item.product.has_only_default_variant -%}
                      <div class="cart-item__options">
                        {%- for option in item.options_with_values -%}
                          <div class="cart-item__option">
                            {{ option.name }}: {{ option.value }}
                          </div>
                        {%- endfor -%}
                      </div>
                    {%- endunless -%}
                  </td>
                  <td class="cart-item__price">
                    <div class="cart-item__price-wrapper">
                      {%- if item.original_price != item.final_price -%}
                        <div class="cart-item__discounted-prices">
                          <s class="cart-item__old-price">
                            {{ item.original_price | money }}
                          </s>
                          <span class="cart-item__final-price">
                            {{ item.final_price | money }}
                          </span>
                        </div>
                      {%- else -%}
                        <span class="cart-item__final-price">
                          {{ item.original_price | money }}
                        </span>
                      {%- endif -%}
                    </div>
                  </td>
                  <td class="cart-item__quantity">
                    <div class="cart-item__quantity-wrapper">
                      <label class="visually-hidden" for="Quantity-{{ item.index | plus: 1 }}">
                        Quantity
                      </label>
                      <div class="quantity-selector">
                        <button type="button" class="quantity-btn" name="minus">
                          {% render 'icon', icon_name: 'theme-minus' %}
                        </button>
                        <input
                          class="quantity-input"
                          type="number"
                          name="updates[]"
                          value="{{ item.quantity }}"
                          min="0"
                          aria-label="Quantity"
                          id="Quantity-{{ item.index | plus: 1 }}"
                          data-index="{{ item.index | plus: 1 }}"
                        >
                        <button type="button" class="quantity-btn" name="plus">
                          {% render 'icon', icon_name: 'theme-plus' %}
                        </button>
                      </div>
                    </div>
                  </td>
                  <td class="cart-item__total">
                    <span class="cart-item__total-price">
                      {{ item.final_line_price | money }}
                    </span>
                  </td>
                </tr>
              {%- endfor -%}
            </tbody>
          </table>
        </div>

        <div class="cart__footer">
          <div class="cart__totals">
            <h3 class="cart__totals-title">Cart Summary</h3>
            <div class="cart__totals-row">
              <span>Subtotal</span>
              <span>{{ cart.total_price | money }}</span>
            </div>
            <div class="cart__actions">
              <button type="submit" name="update" class="cart__update-btn button button--secondary">
                {{ 'cart.update' | t }}
              </button>
              <button type="submit" name="checkout" class="cart__checkout-btn button button--primary">
                {{ 'cart.checkout' | t }}
              </button>
            </div>
          </div>
        </div>
      </form>
    {%- else -%}
      <div class="cart-empty">
        <h2>Your cart is empty</h2>
        <p>Add some products to get started!</p>
        <a href="{{ routes.all_products_collection_url }}" class="button button--primary">
          Continue shopping
        </a>
      </div>
    {%- endif -%}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const quantityButtons = document.querySelectorAll('.quantity-btn');

  quantityButtons.forEach(button => {
    button.addEventListener('click', function() {
      const input = this.parentElement.querySelector('.quantity-input');
      const currentValue = parseInt(input.value);

      if (this.name === 'plus') {
        input.value = currentValue + 1;
      } else if (this.name === 'minus' && currentValue > 1) {
        input.value = currentValue - 1;
      }

      // Trigger change event to update cart
      input.dispatchEvent(new Event('change'));
    });
  });
});
</script>

{% schema %}
{
  "name": "Main Cart",
  "class": "section-main-cart",
  "settings": [
    {
      "type": "select",
      "id": "section_width",
      "label": "Section width",
      "options": [
        {
          "value": "max-w-page",
          "label": "Page"
        },
        {
          "value": "max-w-fluid",
          "label": "Fluid"
        },
        {
          "value": "max-w-full",
          "label": "Full"
        }
      ],
      "default": "max-w-page"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "spacing_top",
      "label": "Spacing top",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "rem",
      "default": 2
    },
    {
      "type": "range",
      "id": "spacing_bottom",
      "label": "Spacing bottom",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "rem",
      "default": 4
    }
  ]
}
{% endschema %}