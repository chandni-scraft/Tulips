{% comment %}
  Simple Image Popup Section
  - Displays a popup with a single image and a close button
  - Settings: image_picker, delay (seconds), open in editor toggle, color scheme
  - No external CSS/JS dependencies; minimal inline styles and script
{% endcomment %}

<style>
  .image-only-popup__backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  .image-only-popup__backdrop.is-open { display: flex; }
  .image-only-popup__dialog {
    position: relative;
    max-width: min(30vw, 900px);
    max-height: 30vh;
  }
   /* Mobile responsive sizing */
  @media screen and (max-width: 768px) {
    .image-only-popup__dialog {
      max-width: 90vw;
      max-height: 80vh;
      margin: 20px;
    }
  }
  .image-only-popup__dialog img { width: 100%; height: auto; display: block; }
  .image-only-popup__close {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(0,0,0,0.65);
    color: #fff;
    border: 0;
    width: 36px;
    height: 36px;
    border-radius: 18px;
    cursor: pointer;
    line-height: 36px;
    text-align: center;
    font-size: 18px;
  }
</style>

<div id="ImageOnlyPopup-{{ section.id }}" class="image-only-popup__backdrop color-{{ section.settings.color_scheme }}"
  role="dialog" aria-modal="true" aria-label="Image popup" hidden>
  <div class="image-only-popup__dialog">
    <button type="button" class="image-only-popup__close" aria-label="Close">Ã—</button>
    {%- if section.settings.image != blank -%}
      {%- assign link_url = section.settings.link_url -%}
      {%- if link_url != blank -%}
        <a href="{{ link_url }}"{% if section.settings.link_new_tab %} target="_blank" rel="noopener"{% endif %}>
      {%- endif -%}
        {%- render 'image',
          image: section.settings.image,
          image_url_width: 1200,
          alt: section.settings.image.alt | escape,
          section_index: section.index,
          loading: 'lazy',
          fetchpriority: 'low'
        -%}
      {%- if link_url != blank -%}
        </a>
      {%- endif -%}
    {%- endif -%}
  </div>
</div>

<script>
  (function() {
    var root = document.getElementById('ImageOnlyPopup-{{ section.id }}');
    if (!root) return;

    var delayMs = {{ section.settings.delay | default: 8 | times: 1000 }};
    {% if request.design_mode and section.settings.show_popup_on_customizer %}
    var openInEditor = true;
    {% else %}
    var openInEditor = false;
    {% endif %}

    function open() {
      root.classList.add('is-open');
      root.removeAttribute('hidden');
    }
    function close() {
      root.classList.remove('is-open');
      root.setAttribute('hidden', 'hidden');
    }

    // Close interactions
    root.addEventListener('click', function(e) {
      if (e.target === root) close();
    });
    var btn = root.querySelector('.image-only-popup__close');
    if (btn) btn.addEventListener('click', close);

    // Auto open
    if (openInEditor) {
      open();
    } else {
      // Respect one-time per session if desired later; for now, always show after delay
      setTimeout(open, delayMs);
    }
  })();
</script>

{% schema %}
{
  "name": "Image popup (simple)",
  "tag": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Popup image"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Image link URL"
    },
    {
      "type": "checkbox",
      "id": "link_new_tab",
      "label": "Open link in a new tab",
      "default": false
    },
    {
      "type": "range",
      "id": "delay",
      "label": "Show after",
      "unit": "s",
      "min": 0,
      "max": 30,
      "step": 1,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_popup_on_customizer",
      "label": "Open automatically in theme editor",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme (backdrop)",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Image popup (simple)",
      "category": "Popups"
    }
  ]
}
{% endschema %}


