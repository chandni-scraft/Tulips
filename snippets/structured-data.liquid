{%- comment -%}
  Outputs JSON-LD structured data for Organization, Product, Collection, and BreadcrumbList.
  Renders safe defaults and only includes blocks relevant to current template.
{%- endcomment -%}

{%- assign shop_logo = settings.favicon | default: shop.logo -%}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ shop.name | json }},
  "url": {{ request.origin | json }},
  {% if shop.email %}"email": {{ shop.email | json }},{% endif %}
  {% if shop.phone %}"telephone": {{ shop.phone | json }},{% endif %}
  {% if shop_logo %}
  "logo": {{ shop_logo | image_url: width: 512 | prepend: 'https:' | json }},
  {% endif %}
  "sameAs": [
    {% if settings.social_facebook_link %}{{ settings.social_facebook_link | json }}{% endif %}
    {% if settings.social_instagram_link %}{% if settings.social_facebook_link %},{% endif %}{{ settings.social_instagram_link | json }}{% endif %}
  ]
}
</script>

{%- comment -%}
  Product JSON-LD is intentionally omitted here to avoid duplicating
  Shopify's built-in `{{ product | structured_data }}` output in
  `sections/main-product.liquid`.
{%- endcomment -%}

{%- if template.name == 'collection' and collection -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": {{ collection.title | json }},
    "description": {{ collection.description | strip_html | strip_newlines | truncate: 5000 | json }},
    "url": {{ collection.url | prepend: request.origin | json }},
    "mainEntity": {
      "@type": "ItemList",
      "itemListElement": [
        {%- for product in collection.products limit: 24 -%}
          {
            "@type": "ListItem",
            "position": {{ forloop.index }},
            "url": {{ product.url | prepend: request.origin | json }}
          }{%- unless forloop.last -%},{%- endunless -%}
        {%- endfor -%}
      ]
    }
  }
  </script>
{%- endif -%}

{%- comment -%} BreadcrumbList based on current context {%- endcomment -%}
{%- capture breadcrumb_items -%}
  {%- assign pos = 1 -%}
  {%- assign root_name = 'Home' -%}
  {
    "@type": "ListItem",
    "position": {{ pos }},
    "name": {{ root_name | json }},
    "item": {{ routes.root_url | prepend: request.origin | json }}
  }
  {%- assign pos = pos | plus: 1 -%}
  {%- if template.name == 'product' and collection -%}
    ,{
      "@type": "ListItem",
      "position": {{ pos }},
      "name": {{ collection.title | json }},
      "item": {{ collection.url | prepend: request.origin | json }}
    }
    {%- assign pos = pos | plus: 1 -%}
  {%- endif -%}
  ,{
    "@type": "ListItem",
    "position": {{ pos }},
    "name": {{ page_title | json }},
    "item": {{ canonical_url | json }}
  }
{%- endcapture -%}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{{ breadcrumb_items | strip }}]
}
</script>


